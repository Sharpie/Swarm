CURRENT = 0
REVISION = 0
AGE = 0
STUBSCURRENT = 0
STUBSREVISION = 0
STUBSAGE = 0
include ../Makefile.common
libdir = @libdir@
srcdir = @srcdir@
top_builddir = ../..
abs_top_builddir := $(shell cd $(top_builddir); pwd)

SHELL = @SHELL@
LIBTOOL = @LIBTOOL@

MOZILLA = $(B)/mozilla/dist

CXX = c++
CPPFLAGS = -I. -I$(MOZILLA)/include

libCOMswarmstubs_la_OBJECTS = $(foreach module,$(MODULES),$(module)_stubs.lo)
libCOMswarm_la_OBJECTS = 

moduleidlheaders = $(subst __u,,$(foreach phase,C S __u,$(addprefix swarmI,$(addsuffix $(phase).h,$($(1)_creatable_PROTOCOLS) $($(1)_noncreatable_PROTOCOLS)))))

modulecppfiles = $(subst __u,,$(foreach phase,C __u,$(addprefix swarm,$(addsuffix $(phase)Impl.cpp,$($(1)_creatable_PROTOCOLS)))))

VPATH = .:$(srcdir)

swarmI%.h: swarmI%.idl
	$(MOZILLA)/bin/xpidl -I$(MOZILLA)/idl -m header $<

all: libCOMswarm.la

$(libCOMswarmstubs_la_OBJECTS): $(foreach module,$(MODULES),$(call moduleidlheaders,$(module)))

%_stubs.cpp:
	cat $(call modulecppfiles,$*) > $@

%.lo: %.cpp
	$(LIBTOOL) --mode=compile $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $<

libCOMswarmstubs.la: $(libCOMswarmstubs_la_OBJECTS)
	$(LIBTOOL) --mode=link $(CXX) $(CXXFLAGS) -o $@ -version-info $(STUBSCURRENT):$(STUBSREVISION):$(STUBSAGE) -rpath $(libdir) $^

libCOMswarm.la: libCOMswarmstubs.la $(libCOMswarm_la_OBJECTS)
	$(LIBTOOL) --mode=link $(CXX) $(CXXFLAGS) -o $@ -version-info $(CURRENT):$(REVISION):$(AGE) -L$(abs_top_builddir)/libobjc -rpath $(libdir) $(libCOMswarm_la_OBJECTS) libCOMswarmstubs.la -L$(abs_top_builddir)/src $(SWARMLIBS) -lobjc



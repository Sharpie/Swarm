include ../Makefile.common

MOZILLA = $(B)/mozilla/dist

_creatable_PROTOCOLS = $(foreach module,$(MODULES),$($(module)_creatable_PROTOCOLS))
_noncreatable_PROTOCOLS = $(foreach module,$(MODULES),$($(module)_noncreatable_PROTOCOLS))

_PROTOCOLS = $(_creatable_PROTOCOLS) $(_noncreatable_PROTOCOLS)
PROTOCOLS = $(foreach phase,C S,$(addsuffix $(phase),$(_PROTOCOLS))) $(_PROTOCOLS)

creatable_PROTOCOLS = $(foreach phase,C S,$(addsuffix $(phase),$(_creatable_PROTOCOLS))) $(_creatable_PROTOCOLS)

IDL = $(addsuffix .idl,$(addprefix swarmI,$(PROTOCOLS)))

IDLHEADERS = $(patsubst %.idl,%.h,$(IDL))

SOURCES = $(addsuffix Impl.cpp,$(addprefix swarm,$(creatable_PROTOCOLS)))

OBJECTS = $(patsubst %.cpp,%.o,$(SOURCES))

CXX = c++
CPPFLAGS = -I. -I$(MOZILLA)/include

swarmI%.h: swarmI%.idl
	$(MOZILLA)/bin/xpidl -I$(MOZILLA)/idl -m header $<

all: $(OBJECTS)

$(OBJECTS): $(IDLHEADERS)


prefix=@prefix@
datadir=@datadir@
jdkdir=@jdkdir@
INSTALL=@INSTALL@
JAR=@JAR@
JAVAC=@JAVAC@
srcdir=@srcdir@
VPATH=$(srcdir)

include ../Makefile.common

CLASSES = Selector SwarmEnvironment GlobalZone

CLASSFILES = $(addprefix swarm/,$(addsuffix .class,$(CLASSES)))

GENCLASSFILES = $(addsuffix .class,$(foreach module,$(MODULES),$(addprefix swarm/$(module)/,$($(module)PROTOCOLS))))

all:
	for module in $(MODULES); do $(MAKE) -C $$module all; done
	cd .. ; JAVA_HOME=$(jdkdir) $(JAR) cf swarm/swarm.jar $(CLASSFILES) $(GENCLASSFILES)

install: all
	test -d $(datadir) || mkdir $(datadir)
	test -d $(datadir)/swarm || mkdir $(datadir)/swarm
	$(INSTALL) swarm.jar $(datadir)/swarm

%.class: %.java
	JAVA_HOME=$(jdkdir) $(JAVAC) -d .. -classpath $(jdkdir)/lib/classes.zip $<

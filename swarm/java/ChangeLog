1999-04-25  Marcus G. Daniels  <mgd@helen.santafe.edu>

	* javaswarm, javacswarm: Adjust classpath per
	JAVA_CLASSES_INSTALLED_AS.

1999-04-25  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (*removed-methods*): Switch getRetVal:buf: to
	getRetVal:. 

1999-04-23  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* javaswarm (JAVASWARMGDB): Use JAVAENV + JAVACMD with 
	JAVASWARMGDB as a hook for gdb (instead of just JAVA).
	Don't insist on arguments if JAVASWARMGDB is set.  
	Use CLASSPATH= instead of -classpath since GDB won't be
	able to cope with the arguments.

1999-04-21  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (*objc-to-java-type-alist*): Handle unsigned short
	and short.  Map unsigned long to long, not int.
	(*removed-methods*): Don't include addArgument:ofObjCType:
	(from FArguments).
	(java-print-native-method): Handle Class.

	* Makefile.am (bin_SCRIPTS): Add javacswarm.

	* javacswarm: New file.

1999-04-20  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (*objc-to-java-type-alist*): Don't treat Class as
	freaky.
	(*removed-protocols*): Remove Class-related excluded protocols.
	(*removed-methods*): Likewise for method.
	(java-type-to-signature): Map Class to Ljava_lang_Class_2.  Remove
	freaky handling.
	(java-type-to-native-type): Handle Class.
	(java-argument-print-conversion): Handle jclass.

1999-04-19  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-argument-print-conversion): Add position
	argument and use it to offset new C variable strings.
	(java-print-method-invocation): Increment position in sync with
	arguments, pass to java-argument-print-conversion.
	(java-print-native-method): Accumulate arguments that are jstrings
	to strings.  If there are any, do a more complex call that
	initializes the C `strings' array and fills it with copies of the
	jstring arguments.  If there is a non-void return type, set a
	return variable, and then cleans up returning the return variable.
	If there are no jstring arguments, the call remains as it was.

1999-04-16  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (*removed-methods*): -getRetVal:buf: instead of
	getReturnVal.

1999-04-07  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* javaswarm: Use eval "$JAVA .." instead of setting JAVA_HOME before
	running Java interpreter (eliminate superfluous use of JAVA_HOME
	for Java implementations where it is not used).

	* Makefile.am (Makefile.common $(SUBMAKEFILES)): Use JAVASTUBS_FUNCTION
	instead of java-run-all.

	* java-stub.el (set-dollar-sign, java-run-all-unicode,
	java-run-all-literal): New functions.
	(java-run-all): Add unicode flag key.
	(*dollar-sign*): New variable.
	(java-print-method-name, java-print-native-method-name): 
	Use *dollar-sign* instead of unicode mangling.

	* javaswarm: Use JAVACLASSES instead of hardcoded classes.zip.
	(LD_LIBRARY_PATH): Add JAVALIBS.  Pre-split :-delimited values.
	Print shell instructions, instead of just value of LD_LIBRARY_PATH
	in non-argument case.  
	Use $JAVA instead of $jdkdir/bin/java.

1999-04-06  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-print-native-class): Print #include jni.h
	after directory.h to avoid jmalloc malloc, free, calloc
	preprocessor redefines causing conflict with stdlib declarations
	of same.  Don't print defobj.h inclusion twice when module is
	defobj.

1999-04-01  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-print-makefiles): Name MODULES by hand, for
	ordering.

1999-03-31  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* Makefile.am (jdkdir): Remove.

1999-03-24  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-print-method,
	java-print-interface-methods-in-phase, java-print-native-method):
	Go back to non-static constructors.

1999-03-23  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-print-native-method): Use
	JINSTANTIATEUSINGFROMCLASS for +create* and
	JINSTANTIATEUSINGFROMOBJECT for -createEnd.
	(*removed-methods*): Add getReturnVal.

1999-03-22  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-suffix-for-phase): Use S and U instead of _s
	and _u (avoids Unicode chars and is easier to type).
	(java-qualified-name, java-qualified-native-name,
	java-qualified-class-name, java-qualified-native-class-name): New
	functions.
	(java-qualified-interface-name): Use java-qualified-name.
	(java-print-method-name): New function.
	(java-print-native-method, java-print-method): Use it.
	(java-print-native-method): Handle +createBegin before other
	+create* methods, which require use of JINSTANTIATENAME with a
	fully qualified using phase class.
	(*objc-to-java-type-alist*): SEL -> swarm.Selector, not Object.
	(*removed-protocols*): Exclude CompleteVarMap, CustomProbeMap,
	DefaultProbeMap, ProbeLibrary, and ActiveOutFile because of use of
	Class.
	(*removed-methods*): Exclude +customizeBegin:, customizeCopy:, and
	-customizeEnd.  Exclude allocBlock: because of void * return and
	FCall's -setJavaMethod:inObject: and getResult because of void*.
	Exclude setProbedClass:.
	(freaky-message): Use error, not message.
	(java-print-method): Add [disabled, argh] support for
	+createBegin: and +create*/-createEnd to returning typed interface
	objects.  Add protocol argument (for typing info).
	(create-method-p): Don't bother checking for +customizeBegin:.
	(java-print-class-methods-in-phase,
	java-print-interface-methods-in-phase): Accomodate.

1999-03-21  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-qualified-interface-name): New function.
	(java-print-implemented-interfaces-list): Use it.
	(java-print-import, java-print-imports): Remove.
	(java-print-class-phase-to-file,
	java-print-interface-phase-to-file): Don't call
	java-print-imports.
	(java-print-native-method): Put two underlines after method name,
	not one.

	* Makefile.am (SWARM_EXTRA_DIST): Add
	swarm/NonUniqueMethodSignatureException.java and
	swarm/SignatureNotFoundException.java.

1999-03-21  Marcus G. Daniels  <mgd@chimayo.santafe.edu>

	* javaswarm: Add . to front of -classpath and $CLASSPATH to end.

1999-03-20  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* javaswarm: Pass -classpath for swarm.jar.  Use $jdkdir/bin/java;
	don't home that the PATH has something reasonable.  Set JAVA_HOME
	for java and pass $jdkdir/lib/classes.zip along with swarm.jar.

	* java-stub.el (java-print-method): Denote factory methods with
	static.
	(create-method-p): New method.
	(included-method-p): Use it; exclude +create* methods when
	protocol is not creatable.  Add protocol argument.
	(java-print-interface-methods-in-phase): Exclude factory methods
	as interfaces don't allow static modifier.
	(creatable-p): Renamed from CREATABLE-p.
	(java-print-method-invocation): Take protocol and method as
	arguments.  Handle factory methods.
	(java-print-native-method): Handle static method arguments and
	+create* methods in particular.
	(java-print-native-class): Don't check methods with
	included-method-p.
	(java-argument-print-conversion, java-print-method-invocation):
	Pass JNIEnv to JFINDOBJC.
	(java-print-native-method): Pass JNIEnv to JUPDATE and
	JSWITCHUPDATE.
	(java-print-makefiles): Print simply the module name; don't use
	computed variable name to get modulePROTOCOLS; it is now done in
	Makefile.rules.

1999-03-19  Vladimir Jojic  <vjojic@wupatki.santafe.edu>

	* java-stub.el (java-print-class-phase): Make all classes
	public.

1999-03-18  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (expanded-method-list): Renamed from method-list.
	(java-print-class-methods-in-phase, java-print-native-class): 
	Accommodate.
	(java-print-native-method): Use JSWITCHUPDATE / JINSTANTIATE of
	user-phase class for createEnd.

	* javaswarm: Print out LD_LIBRARY_PATH additions if there are no
	arguments (otherwise export and run java).

1999-03-17  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* javaswarm: Use \012 instead of \n to avoid problems with ucb tr.

	* java-stub.el (java-print-native-class): Use method-list instead
	of protocol-method-list.

1999-03-16  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* Makefile.am (C_EXTRA_DIST): Add JavaProxy and SwarmEnvironment.
	
	* javaswarm: New file.

	* Makefile.am (bin_SCRIPTS): Install it.

	* java-stub.el (java-print-method-invocation): New function.
	(java-print-native-method): Use it.  Handle +createBegin: and
	-createEnd.

1999-03-11  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-print-method, java-print-native-method):
	Print "$" between method keys (instead of mixing case).
	(java-argument-print-conversion): Handle selectors. 
	(*removed-methods*): Remove the parameter SEL exceptions.
	(java-print-native-class): Don't declare jniEnv extern.
	(java-print-native-method, java-argument-print-conversion): Refer
	to env stub parameter, not jniEnv extern.

	* Makefile.am (SWARM_EXTRA_DIST): Add swarm/Selector.java.

1999-03-09  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (*objc-to-java-type-alist*): Convert timeval_t and
	size_t to long and Color to byte.
	(*removed-protocols*, *removed-methods*): New lists.
	(method-ellipsis-p): New function.
	(removed-method-p): Use it and *removed-methods*.
	(removed-protocol-p): New function.
	(included-protocol-list): Use it instead of just
	the-CREATABLE-protocol-p.
	(java-type-to-native-type): Handle java.lang.reflect.Method.
	(java-argument-print-conversion): Handle jmethodID.
	(java-print-makefiles, java-print-classes): Use removed-protocol-p
	instead of the-CREATABLE-protocol-p.

1999-03-08  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* Makefile.am (C_EXTRA_DIST, SWARM_EXTRA_DIST): New variables.
	(EXTRA_DIST): Include them.

	* java-stub.el (java-type-to-native-type): Add boolean and void.
	(java-argument-print-conversion): New function.
	(java-print-native-method): Make the call. Handle argument and
	return value conversions for String and Object.
	(java-print-native-class): Include the module's header file and
	directory.h.  Declare JNIEnv object.

1999-03-05  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* Makefile.am (jdkdir, JAVASTUBS): Substitute.
	(all, install): Depend on computed variable name based on
	JAVASTUBS.
	(all-stubs, install-stubs): Formerly the all and install targets.

1999-03-02  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (java-print-native-method): Print out some return
	values to avoid compiler warnings [temporary].
	(included-method-p): New function.
	(method-list, java-print-interface-methods-in-phase,
	java-print-native-class): Use included-method-p.
	(java-print-native-class): Import defobj.h.

1999-03-01  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* Makefile.am (SUBMAKEFILES): Use instead of MAKEFILES.  (MAKEFILES
	is the environmental equivalent of include!)
	(install): New target.

	* java-stub.el (java-print-native-method): Take phase argument.
	(java-print-native-class): Loop over creating and using phase,
	passing to java-print-native-method.
	(with-protocol-c-file): Use .m files.

1999-02-28  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* Makefile.am (all, stubs): Mark as phony.
	(stubs): Depend on Makefile.conf and $(MAKEFILES).
	(all): Depend on stubs.
	(Makefile.common $(MAKEFILES)): Depend on java-stub.elc
	and module headers.

	* java-stub.el (*java-path*, *c-path*): New constants.
	(with-protocol-c-file): Use *c-path*.
	(*stub-directory*): Remove.
	(module-path): Don't use *stub-directory*.
	(java-print-makefiles): Simplify to use templates.  Generate
	only Makefile.common with protocol and module lists, and
	per-module Makefiles.
	(java-print-classes): Use *java-path* instead of literal.

	* Makefile.am (stubs): Run stub generation in c and swarm
	directories.

1999-02-27  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el (removed-method-p): Avoid all methods with an
	ellipsis argument.
	(java-print-methods-in-phase): Remove.
	(java-print-interface-methods-in-phase): Loop over protocol
	methods.
	(java-print-class-methods-in-phase): Loop over expanded list of
	methods.
	(*objc-to-java-type-alist*): Treat void*, ref_t, val_t, Protocol*,
	and unsigned long long int as freaky.
	(java-objc-to-java-type): Renamed from java-type-for-objc-type.
	(with-protocol-java-file): Renamed from with-protocol-file.
	(with-protocol-c-file): New macro.
	(mangle-signature, java-type-to-signature,
	java-type-to-native-type, java-argument-convert,
	java-argument-empty-p, java-print-native-method,
	java-print-native-class): New functions.
	(java-print-classes): Call java-print-native-class.
	(java-run-all): Pass :uniquify-method-lists t.
	(module-path): New function.
	(with-protocol-{c,java}-file): Use it.
	(java-print-interface-name): Removed.
	(java-class-name, java-interface-name): New functions.  Latter
	uses former.
	(java-print-makefiles): New function.
	(java-print-classes): Use it.

1999-02-26  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el: Use insert throughout instead of java-print wrapper.
	(ensure-directory): New function.
	(with-protocol-file, java-print-interface-phase-to-file): Use it.
	(java-print-class-phase-to-file): Use it.
	(java-print-classes): Create swarm directory.
	(the-CREATABLE-protocol-p): New function.
	(CREATABLE-p): Use it.
	(removed-method-p): New function.
	(method-list): New function.  Use it.
	(java-print-methods-in-phase): Use it.
	(*objc-to-java-type-alist*): notify_t and long doubles are freaky.
	(java-print-method): Concatenate method keys together into single
	Java method name. Upcase second and after keys.
	(removed-method-p): Also reject getDisplayName, setDisplayName,
	getTypeName, copy, and remove.
	(method-list): Use expanded method list.
	(java-print-argument): Avoid use of "class" as a variable name.
	(freaky-message): New function.
	(java-type-for-objc-type): Use it.
	(java-print-classes): Don't print stubs for CREATABLE protocol.

1999-02-25  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el: Rewrite.  Stubs mostly compile now.  Two
	significant conceptual change: interfaces are generated
	for all phases of classes (prefixed with i_), and abstract
	classes are generated for when a protocol is not tagged CREATABLE.

1999-02-24  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el: Use eval-and-compile to set load-path from
	BUILDDIR.  require protocol instead of loading it.

1999-02-24  Vladimir Jojic  <vjojic@chama.santafe.edu>

	* java-stub-new.el: New java stub generator. 
	(java-make-interface): Convert module symbol to string.
	(java-make-interface-setting): Likewise.
	(java-make-class): Likewise.

1999-02-23  Marcus G. Daniels  <mgd@pojoaque.santafe.edu>

	* java-stub.el: Load protocol.el from $SWARMSRCDIR/etc/protocol.el.
	Remove buffer arguments throughout, depending instead on
	use of with-temp-file, etc.  Use java-print throughout instead of
	print and princ.
	(java-protocol-creatable-p): Renamed from java-is-creatable.
	(*objc-to-java-type-alist*): Regular express alist of type
	conversion rules.
	(*last-protocol*, *stub-directory*): New variables.
	(java-type-for-objc-type): Use it.  Use string-match using alist
	patterns as ^$ wrappedregular expressions.
	(java-protocol-creatable-p): Use find instead of loop.
	(java-print, freakyp): New functions.
	(java-print-type): Print a message when freaky types are seen.
	(java-print-argument): Don't do anything when varname doesn't
	exist (the case of method with no arguments).
	(java-print-methods-in-protocol): Use mapcar instead of loop, set
	(java-print-class): Use with-current-buffer instead of creating
	and passing down Makefile buffer to java-print-makefile.
	(java-print-classes): Kill the makefile-buffer when finished.
	Set *last-protocol* for use by debugging messages.
	(java-print-protocol-list-with-suffix): Remove (similiar contents
	were inlined in java-print-implemented-protocols-list -- now are
	in flet).
	(java-print-implemented-protocols-list): New internal function
	protocol-loop, reused several times.
	(stub-protocol-path): New function.
	(java-print-interface, java-print-interface-setting,
	java-print-class-creating, java-print-class-using): Use it.  Use
	with-temp-file instead of creating buffer by hand and passing it
	down.

1999-02-16  Vladimir Jojic  <vjojic@chama.santafe.edu>

	* java-stub.el: Makefile generation. 

	* Makefile.am (EXTRA_DIST): Add java-stub.el.

	* java-stub.el: New file.


CURRENT = 0
REVISION = 0
AGE = 0
STUBSCURRENT = 0
STUBSREVISION = 0
STUBSAGE = 0
include ../Makefile.common

top_srcdir=@top_srcdir@
top_builddir=../..
abs_top_builddir := $(shell cd $(top_builddir); pwd)
abs_builddir := $(shell pwd)
srcdir=@srcdir@

include $(top_builddir)/etc/Makefile.common

SHELL=@SHELL@
RANLIB=@RANLIB@
INSTALL=@INSTALL@
LIBTOOL=@LIBTOOL@

VPATH=$(srcdir)

jdkdir=@jdkdir@
javaincludedir=$(jdkdir)/include
JAVAINCLUDES=-I$(javaincludedir) -I$(javaincludedir)/solaris -I$(javaincludedir)/genunix

override CPPFLAGS += $(JAVAINCLUDES) -I$(top_builddir)/libobjc -I$(top_srcdir)/libobjc -I$(top_srcdir)/src/misc -I$(top_builddir) -I$(top_builddir)/src -I$(top_srcdir)/src $(foreach module,$(MODULES),-I$(top_builddir)/src/$(module) -I$(top_srcdir)/src/$(module)) -I$(srcdir)

# Solaris JNI headers have some pragmas
override CFLAGS += @CFLAGS_NOWARN_UNKNOWN_PRAGMAS@
override OBJCFLAGS += @CFLAGS_NOWARN_UNKNOWN_PRAGMAS@

modulePROTOCOLS = $(foreach module,$(MODULES),$($(module)PROTOCOLS))

libjavaswarmstubs_la_LDFLAGS = -version-info $(STUBSCURRENT):$(STUBSREVISION):$(STUBSAGE) -rpath $(libdir)

libjavaswarmstubs_la_OBJECTS = $(addsuffix .lo,$(modulePROTOCOLS))

libjavaswarm_la_LDFLAGS = -version-info $(CURRENT):$(REVISION):$(AGE) -L$(abs_builddir)/.libs $(foreach impmodule,$(SWARMMODULES),-L$(abs_top_builddir)/src/$(impmodule)/.libs) -L$(abs_top_builddir)/libobjc/.libs $(SUPPORTLDFLAGS) -rpath $(libdir)

libjavaswarm_la_OBJECTS = directory.lo setup.lo JavaProxy.lo SwarmEnvironment.lo

all: libjavaswarm.la libjavaswarmstubs.la

install: all
	$(LIBTOOL) --mode=install $(INSTALL) libjavaswarm.la $(libdir)
	$(LIBTOOL) --mode=install $(INSTALL) libjavaswarmstubs.la $(libdir)

libjavaswarmstubs.la: $(libjavaswarmstubs_la_OBJECTS)
	$(LIBTOOL) --mode=link $(OBJC) $(CFLAGS) -o $@ $(libjavaswarmstubs_la_LDFLAGS) $(libjavaswarmstubs_la_OBJECTS)

libjavaswarm.la: $(libjavaswarm_la_OBJECTS) libjavaswarmstubs.la
	$(LIBTOOL) --mode=link $(OBJC) $(CFLAGS) -o $@ $(libjavaswarm_la_LDFLAGS) $(libjavaswarm_la_OBJECTS) -ljavaswarmstubs $(SWARMLIBS) $(SYSLIBS)

%.lo: %.m
	$(LIBTOOL) --mode=compile $(OBJC) $(CPPFLAGS) $(OBJCFLAGS) -c $<

%.lo: %.c
	$(LIBTOOL) --mode=compile $(CC) $(CPPFLAGS) $(CFLAGS) -c $<


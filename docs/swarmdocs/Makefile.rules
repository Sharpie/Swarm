JADE = jade
JADETEX = jadetex
DVIPS = dvips
EMACS = emacs

HTML = $(top_srcdir)/html.dsl
PRINT = $(top_srcdir)/print.dsl
CATOPTS = -c $(top_builddir)/catalog -c @docbookdtd_srcdir@/docbook.cat -c @docbookstyle_srcdir@/CATALOG

.PHONY: fot tex dvi ps rtf html

_$(NAME).tex $(addprefix $(NAME),.fot .html .rtf): $(SGML_FILES) $(top_srcdir)/common.dsl $(SWARMBOOK)

$(NAME).dvi: $(top_srcdir)/macros.tex

fot: all $(NAME).fot

tex: all _$(NAME).tex

dvi: all $(NAME).dvi

ps: all $(NAME).ps

rtf: all $(NAME).rtf

html: all $(NAME).html

%.fot: %.sgml
	 $(JADE) $(CATOPTS) -t fot -iprint -d $(PRINT) -o $@ $< 

_%.tex: %.sgml
	- $(JADE) $(CATOPTS) -t tex -iprint -d $(PRINT) -o $@ $<

%.rtf: %.sgml
	- $(JADE) $(CATOPTS) -t rtf -iprint -d $(PRINT) -o $@ $<

%.html: %.sgml
	- $(JADE) $(CATOPTS) -t sgml -ihtml -d $(HTML) $<

%.dvi: %.tex _%.tex
	$(JADETEX) $< ; $(JADETEX) $< 

%.ps: %.dvi
	$(DVIPS) -o $@ $<

%revhistory.sgml: ChangeLog $(swarm_ChangeLog) $(top_srcdir)/history.el $(top_srcdir)/common.el
	SWARMDOCS=`cd $(top_srcdir); pwd`/ SWARMDOCS_BUILD_AREA=$(top_builddir)/ $(EMACS) -batch -l $(top_srcdir)/history.el -f process-changelog $*

JADE = @JADE@
JADETEX = @JADETEX@
DVIPS = @DVIPS@
GZIP = gzip --best

HTML = $(top_srcdir)/html.dsl
PRINT = $(top_srcdir)/print.dsl
CATOPTS = -c $(top_builddir)/catalog -c @docbookdtd_srcdir@/docbook.cat -c @docbookstyle_srcdir@/CATALOG
GENERAL = $(SGML_FILES) $(COMMON_SGML_FILES) $(top_srcdir)/common.dsl

.PHONY: fot tex dvi ps rtf html figs htmldist dvidist psdist rtfdist

COMMON_SGML_FILES = $(top_srcdir)/figs/figs.ent $(top_srcdir)/global.ent $(top_builddir)/versions.ent

DISTNAME=$(NAME)-@VERSION@

htmldir = $(prefix)/html/$(NAME)
html_DATA = $(NAME).html

install-data-local:
	$(INSTALL_DATA) $(filter-out $(NAME).html,$(wildcard *.html)) $(htmldir)

htmldist: html
	cd .. ; tar cf - $(addprefix $(NAME)/,$(wildcard *.html)) $(NAME)/figs | $(GZIP) > $(DISTNAME)-html.tar.gz

dvidir = $(prefix)/dvi
dvi_DATA = $(NAME).dvi

dvidist: dvi
	cd .. ; tar cf - $(NAME)/$(NAME).dvi $(NAME)/figs | $(GZIP) > $(DISTNAME)-dvi.tar.gz

psdir = $(prefix)/ps
ps_DATA = $(NAME).ps

psdist: ps
	cd ..; $(GZIP) < $(NAME)/$(NAME).ps > $(DISTNAME).ps.gz

rtfdir = $(prefix)/rtf
rtf_DATA = $(NAME).rtf

rtfdist: rtf
	cd .. ; tar cf - $(NAME)/$(NAME).rtf $(NAME)/figs | $(GZIP) > $(DISTNAME)-rtf.tar.gz 

CLEANFILES = $(NAME).tex _$(NAME).tex $(html_DATA) $(ps_DATA) $(rtf_DATA) $(NAME).dvi

figs:
	make -C $(top_builddir)/figs install figsdir=`pwd`/figs

_$(NAME).tex $(addprefix $(NAME),.fot .rtf): $(GENERAL) $(PRINT) figs

$(NAME).html: $(GENERAL) $(HTML) figs

$(NAME).dvi: $(top_srcdir)/macros.tex figs

fot: $(NAME).fot

tex: _$(NAME).tex

dvi: $(NAME).dvi

ps: $(NAME).ps

rtf: $(NAME).rtf

html: $(NAME).html

%.fot: %.sgml
	$(JADE) $(CATOPTS) -t fot -iprint -d $(PRINT) -o $@ $< 

_%.tex: %.sgml
	$(JADE) $(CATOPTS) -t tex -iprint -d $(PRINT) -o $@ $<

%.rtf: %.sgml
	$(JADE) $(CATOPTS) -t rtf -iprint -d $(PRINT) -o $@ $<

%.html: %.sgml
	$(JADE) $(CATOPTS) -t sgml -ihtml -d $(HTML) $<

%.dvi: %.tex _%.tex
	- $(JADETEX) $< ; $(JADETEX) $< 

%.ps: %.dvi
	$(DVIPS) -o $@ $<

# Local variables:
# mode: makefile
# end:
